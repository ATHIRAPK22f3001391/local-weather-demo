<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>City Weather | Open‑Meteo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8fafc; }
    .stat { font-size: 2rem; font-weight: 600; }
    .unit { font-size: 1rem; opacity: 0.8; margin-left: .25rem; }
    .footer { font-size: .9rem; color: #6c757d; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <h1 class="mb-3 text-center">Current Weather</h1>
        <p class="text-center text-muted mb-4">Enter a city to get temperature and humidity using the Open‑Meteo API.</p>

        <div class="card shadow-sm">
          <div class="card-body">
            <div class="input-group">
              <input id="cityInput" type="text" class="form-control form-control-lg" placeholder="e.g., London, New York, Tokyo" aria-label="City name">
              <button id="fetchBtn" class="btn btn-primary btn-lg" type="button">
                <span id="btnText">Get Weather</span>
                <span id="btnSpinner" class="spinner-border spinner-border-sm d-none ms-2" role="status" aria-hidden="true"></span>
              </button>
            </div>
            <div id="msg" class="mt-3"></div>

            <div id="result" class="mt-4 d-none">
              <h5 id="resolvedTitle" class="mb-3"></h5>

              <div class="row g-3">
                <div class="col-md-6">
                  <div class="border rounded-3 p-3 h-100 bg-light">
                    <div class="text-muted">Temperature</div>
                    <div class="stat"><span id="tempVal">—</span><span class="unit">°C</span></div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="border rounded-3 p-3 h-100 bg-light">
                    <div class="text-muted">Humidity</div>
                    <div class="stat"><span id="humVal">—</span><span class="unit">%</span></div>
                  </div>
                </div>
              </div>

              <div class="footer mt-3">
                Data by Open‑Meteo • Units: Celsius and % relative humidity
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-4">
          <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open‑Meteo Docs</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const el = (id) => document.getElementById(id);
    const cityInput = el('cityInput');
    const fetchBtn = el('fetchBtn');
    const btnText = el('btnText');
    const btnSpinner = el('btnSpinner');
    const msg = el('msg');
    const result = el('result');
    const resolvedTitle = el('resolvedTitle');
    const tempVal = el('tempVal');
    const humVal = el('humVal');

    function setLoading(isLoading) {
      fetchBtn.disabled = isLoading;
      btnSpinner.classList.toggle('d-none', !isLoading);
      btnText.textContent = isLoading ? 'Loading' : 'Get Weather';
    }

    function showMessage(text, type = 'info') {
      msg.innerHTML = `<div class="alert alert-${type} mb-0" role="alert">${text}</div>`;
    }

    function clearMessage() {
      msg.innerHTML = '';
    }

    async function getWeatherForCity(city) {
      clearMessage();
      result.classList.add('d-none');

      if (!city || !city.trim()) {
        showMessage('Please enter a city name.', 'warning');
        return;
      }

      setLoading(true);
      try {
        // 1) Geocode city to coordinates
        const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=en&format=json`;
        const geoRes = await fetch(geoUrl);
        if (!geoRes.ok) throw new Error('Geocoding request failed.');
        const geoData = await geoRes.json();

        if (!geoData || !geoData.results || geoData.results.length === 0) {
          showMessage(`No results found for "${city}". Try a different city or include country/state.`, 'warning');
          return;
        }

        const loc = geoData.results[0];
        const { latitude, longitude, name, country, admin1 } = loc;

        // 2) Fetch current weather (temperature and humidity)
        const wxUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m`;
        const wxRes = await fetch(wxUrl);
        if (!wxRes.ok) throw new Error('Weather request failed.');
        const wxData = await wxRes.json();

        const current = wxData.current || {};
        const temp = current.temperature_2m;
        const humidity = current.relative_humidity_2m;

        if (typeof temp !== 'number' || typeof humidity !== 'number') {
          showMessage('Could not retrieve temperature/humidity for this location.', 'danger');
          return;
        }

        // Populate UI
        const placeParts = [name, admin1, country].filter(Boolean);
        resolvedTitle.textContent = placeParts.join(', ');
        tempVal.textContent = Math.round(temp);
        humVal.textContent = Math.round(humidity);

        result.classList.remove('d-none');
      } catch (err) {
        console.error(err);
        showMessage('Something went wrong while fetching data. Please try again.', 'danger');
      } finally {
        setLoading(false);
      }
    }

    fetchBtn.addEventListener('click', () => getWeatherForCity(cityInput.value));
    cityInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') getWeatherForCity(cityInput.value);
    });
  </script>
</body>
</html>